# ============================================================================
# ScalpingBot v3.0 설정 파일
# ============================================================================
# 거래 비용: 슬리피지 0.30% + 수수료 0.03% + 세금 0.18% = 0.51%
# 손익분기 승률: 55%
# ============================================================================

# -----------------------------------------
# 운영 모드
# -----------------------------------------
mode: LIVE_MICRO  # LIVE_DATA_ONLY / LIVE_MICRO / LIVE

# -----------------------------------------
# 프리마켓 분석 (08:50 시작 → 동시호가 거래량 반영)
# -----------------------------------------
premarket:
  enabled: true
  start_time: "08:50"
  schedule:
    volume_top: "08:50"
    news_collect: "08:52"
    sector_analysis: "08:54"
    ai_analysis: "08:55"
    gap_analysis: "09:00"
  volume_top_count: 50
  news_per_stock: 5

# -----------------------------------------
# AI 설정
# -----------------------------------------
ai:
  provider: gemini
  model: gemini-2.5-flash
  timeout: 60
  max_queue_size: 10
  retry_count: 2
  use_for_entry: false
  use_for_universe: true
  use_for_news: true
  use_for_review: true
  use_for_quick_filter: true   # 장중 AI 필터 (테스트 중)

# -----------------------------------------
# 매매 전략
# -----------------------------------------
trading:
  # 손절/익절 (슬리피지 0.3% + 비용 0.2% 감안)
  stop_loss: -0.8              # -1.2 → -0.8 (실제 -1.1%)
  take_profit_1: 2.5           # 2.0 → 2.5 (분위기 좋을 때)
  take_profit_2: 3.5           # 3.0 → 3.5
  
  # 기술적 필터 (MACD OR RSI) - OR 조건으로 완화됨
  use_technical_filter: true
  
  # 트레일링 스탑 (net 기준으로 발동)
  trailing:
    enabled: true
    activation: 1.2            # 0.8 → 1.2 (net +0.7% 이상)
    distance: 0.8              # 0.5 → 0.8 (여유있게)
  
  # 시간 손절 (0% 청산 방지)
  time_stop:
    enabled: true
    no_profit_minutes: 12      # 7 → 12분
    no_profit_threshold: 0.7   # 0.2 → 0.7% (비용 커버)
    max_hold_minutes: 20       # 15 → 20분
  
  # 시간 설정
  market_open: "09:05"
  market_close: "15:07"        # 15:15 → 15:07 (시간손절 12분 + 여유)
  force_close_time: "15:07"    # 14:50 → 15:07

  # 점심시간 매수 금지
  lunch_break_enabled: true
  lunch_break_start: "12:00"
  lunch_break_end: "13:00"     # 13:00 → 13:30으로 변경 가능
  
  # 진입 점수 (거래 빈도↓, 기대값↑)
  min_score: 70                # 65 → 70
  min_score_conservative: 75   # 70 → 75

# -----------------------------------------
# 분봉 지표
# -----------------------------------------
indicators:
  candle_interval: 5
  cci_period: 14
  rsi_period: 14
  volume_avg_period: 10
  
  # 전략 활성화 (vwap_bounce는 슬리피지에 취약)
  strategies:
    breakout: true
    pullback: true
    gap_play: true
    vwap_bounce: false         # 비활성화 (떨어지는 칼날 금지)
  
  breakout:
    cci_min: 100
    cci_max: 150       # ★ CCI 150 이상이면 이미 과열 → 진입 금지
    rsi_max: 70        # RSI 70으로 하향 (80은 과매수)
    volume_min: 2.0
  
  pullback:
    min_rise: 2.0
    correction_min: -0.5
    correction_max: -1.5
    volume_decrease: 0.7
  
  gap_play:
    gap_min: 0.5
    gap_max: 3.0

# -----------------------------------------
# 안전 장치 (예수금 50만원 기준)
# -----------------------------------------
safety:
  max_positions: 3
  max_position_size: 130000     # 종목당 13만원
  max_total_exposure: 450000    # 총 45 만원
  
  max_daily_loss: -15000        # 일일 -1.5만원
  max_daily_loss_pct: -3.0
  max_daily_trades: 20
  
  consecutive_loss_rest: 3      # 3연패 → 10분 휴식 ✅ 이제 작동함!
  rest_minutes: 10
  consecutive_loss_stop: 7      # 7연패 → 당일 중단 + 프로그램 종료
  
  index_emergency_threshold: -2.5
  index_conservative_threshold: -1.5

# -----------------------------------------
# 유니버스 (시총: 250억 ~ 10조)
# -----------------------------------------
universe:
  condition_name: "TV100"
  target_size: 50
  min_price: 3000
  max_price: 50000              # 5만원 이하 (스캘핑 적합)
  min_volume: 500000
  min_market_cap: 25000000000   # 250억 (0.25조)
  max_market_cap: 10000000000000 # 10조
  refresh_interval: 10          # 장중 갱신 주기 (분)
  
  prev_day:
    min_change_pct: 0.5
    max_change_pct: 15.0
    min_volume_ratio: 1.5
  
  exclude_codes:
    - "000000"

# -----------------------------------------
# 모니터링
# -----------------------------------------
monitoring:
  scan_interval: 5
  position_check_interval: 1
  candle_refresh_interval: 5

# -----------------------------------------
# 데이터베이스
# -----------------------------------------
database:
  path: db/scalping.db
  backup_enabled: true
  backup_time: "15:35"

# -----------------------------------------
# 로깅
# -----------------------------------------
logging:
  level: INFO
  file_path: logs/scalping.log
  max_size_mb: 50
  backup_count: 7
  log_signals: true
  log_indicators: false
  log_api_calls: false

# -----------------------------------------
# Discord 알림
# -----------------------------------------
discord:
  enabled: true
  notify_on:
    buy: true
    sell: true
    stop_loss: true
    take_profit: true
    time_stop: true
    emergency: true
    daily_report: true